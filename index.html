<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduMorph v2.4 - Adaptive Learning Modes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-solid { background: #1e293b; border: 1px solid rgba(255, 255, 255, 0.05); }
        .gradient-text { background: linear-gradient(to right, #4ade80, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .mermaid { display: flex; justify-content: center; background: transparent; }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden">

    <nav class="w-full glass fixed top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-slate-700">
        <div class="flex items-center gap-2 cursor-pointer" onclick="resetApp()">
            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-600 rounded-lg flex items-center justify-center font-bold text-black">E</div>
            <div class="text-xl font-bold tracking-tight">Edu<span class="gradient-text">Morph</span></div>
        </div>
        <div id="user-badge" class="hidden text-xs font-mono text-green-400 bg-slate-800 px-3 py-1 rounded-full border border-slate-700"></div>
    </nav>

    <main id="app" class="flex-grow pt-24 px-4 md:px-12 pb-10 flex flex-col items-center w-full max-w-7xl mx-auto">
        </main>

    <div id="modal-overlay" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white text-slate-900 w-full max-w-2xl rounded-2xl p-8 relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-red-500 font-bold text-xl">&times;</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'dark', securityLevel: 'loose' });

        // --- CORE KNOWLEDGE BASE (6 Concepts) ---
        const knowledgeBase = {
            "polynomials": {
                title: "Polynomials (Math)", tags: ["Maths", "Algebra"], 
                simple: "Polynomials are expressions where powers of variables are non-negative integers. **Degree** is the highest power. The key identity is the Remainder Theorem.",
                visual: "graph TD\nA[Polynomials] --> B{By Terms}\nB --> B1[Monomial: 5x]\nB --> B2[Binomial: x+2]\nA --> C{By Degree}\nC --> C1[Linear: 2x+1]\nC --> C2[Quadratic: x^2+3]",
                story: "Polynomials are like multi-part recipes. Each term is an ingredient, and the highest power is the most expensive ingredient.",
                exam: { cbse: "<div>Q: Factorise: xÂ² + 5x + 6 using splitting the middle term (3 Marks).</div>" },
                quiz: [{ q: "What is the degree of 4xÂ³?", options: ["2", "3", "4", "1"], correct: 1 }]
            },
            "triangles": {
                title: "Triangles (Math)", tags: ["Maths", "Geometry"],
                simple: "A 3-sided polygon. Sum of angles = 180Â°. **Congruence Rules** (SSS, SAS, ASA, RHS) prove identical shape/size.",
                visual: "graph TD\nA[Triangles] --> B{Congruence Rules}\nB --> B1(SSS)\nB --> B2(SAS)\nB --> B3(ASA)",
                story: "Triangles are the strongest shape in construction, like the frame of a bridge, because they cannot be deformed by force.",
                exam: { cbse: "<div>Q: Prove that angles opposite to equal sides of an isosceles triangle are equal. (4 Marks)</div>" },
                quiz: [{ q: "What is the SSS rule for?", options: ["Similarity", "Area", "Perimeter", "Congruence"], correct: 3 }]
            },
            "newton's second law": {
                title: "Newton's Second Law (Physics)", tags: ["Physics", "Force", "Motion"],
                simple: "The rate of change of momentum is proportional to the net external force. Formula: **F = ma**.",
                visual: "graph LR\nForce(F) -->|Acts on| Mass(m)\nMass -->|Creates| Accel(a)",
                story: "Pushing a stalled car (high mass) requires more force than pushing a bicycle (low mass) to get the same acceleration.",
                exam: { cbse: "<div>Q: Why does a cricketer pull his hands back while catching a fast ball? (2 Marks)</div>" },
                quiz: [{ q: "F = ?", options: ["ma", "m/a", "m+a", "a/m"], correct: 0 }]
            },
             "tissues": {
                title: "Tissues (Biology)", tags: ["Biology", "Cells"],
                simple: "A group of similar cells performing a specific function. Plant tissues are supportive (like Meristematic), animal tissues are complex (like Muscular, Nervous).",
                visual: "graph TD\nA[Tissues] --> B(Plant Tissues)\nB --> B1[Meristematic]\nA --> C(Animal Tissues)\nC --> C1[Epithelial]\nC --> C2[Muscular]",
                story: "Tissues are specialized worker teams in a factory. The Muscular team are the movers, the Epithelial team are the security guards (covering surfaces).",
                exam: { cbse: "<div>Q: Differentiate between parenchyma, collenchyma, and sclerenchyma tissues. (3 Marks)</div>" },
                quiz: [{ q: "Which tissue is responsible for movement in animals?", options: ["Nervous", "Epithelial", "Muscular", "Connective"], correct: 2 }]
            },
            "french revolution": {
                title: "The French Revolution (History)", tags: ["History", "Civics"],
                simple: "A period (1789-1799) of radical change driven by **social inequality** (Third Estate) and **economic crisis** (high taxes).",
                visual: "graph TD\nSocial Inequality --> High Taxes\nHigh Taxes --> Debt Crisis\nDebt Crisis --> Storming of Bastille",
                story: "Imagine a school where 97% of students pay all the lunch money while the 3% elite eat free. The 97% eventually rebelled.",
                exam: { cbse: "<div>Q: List any three causes of the empty treasury of France under Louis XVI. (3 Marks)</div>" },
                quiz: [{ q: "When was the Bastille prison stormed?", options: ["1776", "1789", "1804", "1815"], correct: 1 }]
            },
             "nationalism in india": {
                title: "Nationalism in India (History)", tags: ["History", "Freedom Struggle"],
                simple: "The movement for independence from British rule. Key phases include Non-Cooperation and Civil Disobedience under Gandhi's leadership.",
                visual: "graph TD\nWorld War I --> Economic Hardship\nEconomic Hardship --> Rowlatt Act\nRowlatt Act --> Jallianwala Bagh\nJallianwala Bagh --> Non-Cooperation Movement",
                story: "Imagine a playground where one group (British) makes all the rules. Nationalism is when the other children realize their collective strength to win back the playground.",
                exam: { cbse: "<div>Q: Why did the Non-Cooperation Movement gradually slow down in cities? (3 Marks)</div>" },
                quiz: [{ q: "Which event forced Gandhi to call off the Non-Cooperation Movement?", options: ["Salt March", "Chauri Chaura Incident", "Dandi March", "Round Table Conference"], correct: 1 }]
            }
        };

        // --- STATE & INITIALIZATION ---
        let state = { 
            step: 'onboarding', 
            class: null, 
            board: null, 
            currentTopicKey: null, 
            quizScore: 0, 
            quizIndex: 0,
            learningMode: 'learning' // Default mode
        };
        
        function init() { renderOnboarding(); }
        function resetApp() { state = { step: 'onboarding', class: null, board: null, currentTopicKey: null, learningMode: 'learning' }; init(); }
        function selectClass(c) { state.class = c; updateUI('btn-c', c, [9,10]); checkReady(); }
        function selectBoard(b) { state.board = b; updateUI('btn-', b.toLowerCase(), ['cbse','icse']); checkReady(); }
        function updateUI(prefix, sel, opts) {
            opts.forEach(o => document.getElementById(prefix+o).className = "flex-1 py-3 bg-slate-800 rounded-xl border border-slate-600 text-slate-400");
            document.getElementById(prefix+sel).className = "flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg";
        }
        function checkReady() { if(state.class && state.board) document.getElementById('btn-start').disabled = false; document.getElementById('btn-start').classList.remove('opacity-50'); }
        function toggleAns(id) { document.getElementById(id).classList.toggle('hidden'); }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); }
        function runSearch(term) { document.getElementById('searchInput').value = term; search(); }
        function setMode(mode) {
            state.learningMode = mode;
            renderTopicSelection(); // Move to the next step
        }
        
        // --- CORE SEARCH LOGIC: Updated to include 6 concepts ---

        function search() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const app = document.getElementById('app');
            app.innerHTML = `<div class="mt-20 text-center"><div class="animate-spin text-4xl mb-4 text-blue-500">ðŸŒ€</div><p class="text-slate-400">Searching all 9th & 10th concepts...</p></div>`;
            
            setTimeout(() => {
                let topicKey = null;

                // 1. Check Exact Matches (All 6 Concepts)
                if (term.includes('poly') || term.includes('algebra')) topicKey = "polynomials";
                else if (term.includes('triang') || term.includes('geo')) topicKey = "triangles";
                else if (term.includes('newton') || term.includes('force') || term.includes('motion')) topicKey = "newton's second law";
                else if (term.includes('tissue') || term.includes('cell') || term.includes('bio')) topicKey = "tissues";
                else if (term.includes('french') || term.includes('revolution')) topicKey = "french revolution";
                else if (term.includes('nation') || term.includes('india') || term.includes('gandhi')) topicKey = "nationalism in india";
                
                // 2. Check Broader Subject Area (Redirect to most recent sample)
                else if (term.includes('math')) topicKey = "triangles"; 
                else if (term.includes('science')) topicKey = "tissues";
                else if (term.includes('sst') || term.includes('history') || term.includes('civics')) topicKey = "nationalism in india";
                
                state.currentTopicKey = topicKey;

                if (topicKey) {
                    renderModeSelection(); // New step before dashboard
                } else {
                    app.innerHTML = `
                        <div class="mt-20 text-center text-red-400 font-bold max-w-lg mx-auto p-6 glass rounded-xl">
                            <h3 class="text-xl mb-4 text-yellow-400">Topic Not Found in Sample Database</h3>
                            <p class="text-slate-300 font-normal">Please search for one of the six loaded concepts, e.g., **Triangles, Tissues, or Nationalism**.</p>
                            <button onclick="goToSearch()" class="mt-4 text-blue-400 underline font-bold">Try Another Search</button>
                        </div>`;
                }
            }, 800);
        }

        // --- NEW RENDER STEP: MODE SELECTION ---
        function renderModeSelection() {
            const topicTitle = knowledgeBase[state.currentTopicKey].title;
            document.getElementById('app').innerHTML = `
                <div class="fade-in max-w-3xl w-full text-center mt-12">
                    <h2 class="text-3xl font-bold mb-4">You chose: <span class="gradient-text">${topicTitle}</span></h2>
                    <p class="text-slate-400 mb-10">How would you like to learn today?</p>
                    
                    <div class="grid grid-cols-2 gap-6">
                        ${getModeButton('easy', 'Easy Mode (Conceptual)', 'Simplest analogies & story-first.', 'bg-green-600/20 hover:bg-green-600/40')}
                        ${getModeButton('learning', 'Learning Mode (Balanced)', 'Standard view: Visuals and core definitions.', 'bg-blue-600/20 hover:bg-blue-600/40')}
                        ${getModeButton('hard', 'Hard Mode (Technical)', 'Formula-first, precision definitions, advanced details.', 'bg-yellow-600/20 hover:bg-yellow-600/40')}
                        ${getModeButton('finals', 'Finals Mode (Assessment)', 'Exam questions and quick review tabs only. Time to test.', 'bg-red-600/20 hover:bg-red-600/40')}
                    </div>
                </div>
            `;
        }

        function getModeButton(mode, title, desc, colorClass) {
            return `
                <div onclick="setMode('${mode}'); renderDashboard()" class="glass-solid p-5 rounded-xl cursor-pointer ${colorClass} text-left transition">
                    <h3 class="text-xl font-bold mb-2">${title}</h3>
                    <p class="text-sm text-slate-400">${desc}</p>
                </div>
            `;
        }

        // --- DASHBOARD: ADAPTIVE RENDERING ---
        function renderDashboard() {
            const data = knowledgeBase[state.currentTopicKey];
            const app = document.getElementById('app');
            const mode = state.learningMode;
            let initialTab = 'visual';
            let tabsToShow = ['simple', 'visual', 'story', 'exam'];

            // Logic to determine initial tab and visible tabs based on mode
            if (mode === 'easy') initialTab = 'story';
            else if (mode === 'hard') initialTab = 'visual';
            else if (mode === 'finals') { 
                initialTab = 'exam'; 
                // In finals mode, only show Exam and Quiz button, hide deep content tabs
                tabsToShow = ['exam', 'simple']; // simple for quick lookup if needed
            } else { // learning mode
                initialTab = 'visual';
            }

            // Determine border color based on subject for visual flair
            let borderColor = data.tags.includes('Maths') ? 'border-yellow-500' : data.tags.includes('Physics') || data.tags.includes('Biology') ? 'border-green-500' : 'border-red-500';

            app.innerHTML = `
                <div class="fade-in w-full">
                    <button onclick="renderModeSelection()" class="mb-4 text-sm text-slate-400 hover:text-white">&larr; Change Mode</button>
                    <div class="flex flex-col lg:flex-row gap-6">
                        <div class="w-full lg:w-1/4">
                            <div class="glass p-6 rounded-2xl mb-4 border-l-4 ${borderColor}">
                                <h1 class="text-2xl font-bold">${data.title}</h1>
                                <div class="text-xs font-bold uppercase mt-2 ${mode === 'finals' ? 'text-red-400' : 'text-blue-400'}">${mode.toUpperCase()} MODE</div>
                            </div>
                            <button onclick="startQuiz()" class="w-full py-3 bg-red-600 rounded-xl font-bold mb-2 ${mode === 'finals' ? 'ring-4 ring-red-400/50' : ''}">âš¡ Take Quiz ${mode === 'finals' ? '(PRIORITY)' : ''}</button>
                        </div>
                        <div class="w-full lg:w-3/4">
                            <div class="flex gap-2 mb-4">
                                ${tabsToShow.map(t => 
                                    `<button onclick="renderDashboard('${t}')" class="px-4 py-2 rounded-full text-sm font-bold ${initialTab===t ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}">${t.charAt(0).toUpperCase()+t.slice(1)}</button>`
                                ).join('')}
                            </div>
                            <div class="glass p-8 rounded-2xl min-h-[300px]">
                                ${getContent(initialTab, data)}
                            </div>
                        </div>
                    </div>
                </div>`;
            if(initialTab === 'visual') mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }

        function getContent(tab, data) {
            // Hard Mode Logic Adjustment: Pulls from multiple sources for density
            if (state.learningMode === 'hard' && tab === 'simple') {
                return `
                    <h3 class="text-xl font-bold text-yellow-400">Technical Overview:</h3>
                    <p class="mb-4">${data.simple}</p>
                    <h4 class="font-bold text-slate-300 mt-4">Key Context:</h4>
                    <p class="text-sm text-slate-400">${data.story}</p>
                `;
            }
            // Easy Mode Logic Adjustment: Prioritizes story and analogy
            if (state.learningMode === 'easy' && tab === 'story') {
                return `
                    <h3 class="text-xl font-bold text-green-400">Analogy First:</h3>
                    ${data.story}
                    <h4 class="font-bold text-slate-300 mt-6">Core Concept:</h4>
                    <p class="text-sm text-slate-400">${data.simple}</p>
                `;
            }
            // Default content
            if(tab === 'visual') return `<div class="mermaid">${data.visual}</div>`;
            if(tab === 'exam') return data.exam.cbse || data.exam;
            return data[tab];
        }

        function startQuiz() { 
            const topic = knowledgeBase[state.currentTopicKey];
            document.getElementById('modal-content').innerHTML = `
                <h3 class="text-2xl font-bold text-slate-900">Quiz for: ${topic.title}</h3>
                <p class="text-slate-600">You are in **${state.learningMode.toUpperCase()} MODE**.</p>
                <div class="mt-4 p-4 bg-slate-100 rounded-lg border border-slate-300">
                    <p class="font-bold text-lg text-blue-800">${topic.quiz[0].q}</p>
                    <p class="text-sm mt-2 text-slate-500">Correct Answer Index: ${topic.quiz[0].correct}</p>
                </div>
                <button onclick="closeModal()" class="mt-6 px-4 py-2 bg-blue-600 text-white rounded">Close & Return</button>
            `;
            document.getElementById('modal-overlay').classList.remove('hidden');
        }

        init();
    </script>
</body>
</html>
