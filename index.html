<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduMorph v2.0 - Fully Functional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: #f8fafc; }
        
        /* Glassmorphism */
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-solid { background: #1e293b; border: 1px solid rgba(255, 255, 255, 0.05); }
        
        .gradient-text { background: linear-gradient(to right, #4ade80, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Mermaid Styling Overrides */
        .mermaid { background: transparent; display: flex; justify-content: center; }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden">

    <nav class="w-full glass fixed top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-slate-700">
        <div class="flex items-center gap-2 cursor-pointer" onclick="resetApp()">
            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-600 rounded-lg flex items-center justify-center font-bold text-black">E</div>
            <div class="text-xl font-bold tracking-tight">Edu<span class="gradient-text">Morph</span></div>
        </div>
        <div id="user-badge" class="hidden text-xs font-mono text-green-400 bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
            </div>
    </nav>

    <main id="app" class="flex-grow pt-24 px-4 md:px-12 pb-10 flex flex-col items-center w-full max-w-7xl mx-auto">
        </main>

    <div id="modal-overlay" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white text-slate-900 w-full max-w-2xl rounded-2xl p-8 slide-up relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-red-500 font-bold text-xl">&times;</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: false, theme: 'dark', securityLevel: 'loose' });

        // --- DATABASE (The Brain) ---
        const knowledgeBase = {
            "newton's second law": {
                title: "Newton's Second Law",
                tags: ["Physics", "Force", "Motion"],
                simple: `
                    <h3 class="text-2xl font-bold mb-4 text-green-400">The "Push" Rule</h3>
                    <p class="mb-4 text-lg">Think of it simply: <strong>Force = Mass √ó Acceleration (F=ma)</strong>.</p>
                    <p class="mb-4">It connects three things:</p>
                    <ul class="list-disc pl-6 space-y-2 mb-6 text-slate-300">
                        <li><strong>Mass (m):</strong> How heavy the object is.</li>
                        <li><strong>Force (F):</strong> How hard you push it.</li>
                        <li><strong>Acceleration (a):</strong> How fast it speeds up.</li>
                    </ul>
                    <div class="bg-slate-800 p-4 rounded-xl border-l-4 border-blue-500">
                        <strong>Analogy:</strong> Pushing a shopping cart. <br>
                        - Empty cart (low mass) = Easy to speed up (high acceleration).<br>
                        - Full cart (high mass) = Hard to push (needs more Force).
                    </div>
                `,
                // Mermaid Diagram Syntax
                visual: `
                    graph TD
                    A[Start: You want to move an object] -->|Apply| B(Force F)
                    B -->|Acts on| C{Mass m}
                    C -->|Result| D[Acceleration a]
                    D -->|Formula| E[F = m * a]
                    
                    style A fill:#1e293b,stroke:#3b82f6,stroke-width:2px
                    style B fill:#1e293b,stroke:#4ade80,stroke-width:2px
                    style E fill:#3b82f6,stroke:#fff,stroke-width:2px,color:#fff
                `,
                story: `
                    <h3 class="text-xl font-bold mb-3 text-yellow-400">The Broken Car Dilemma</h3>
                    <p class="mb-4">Imagine your dad's car breaks down in the middle of the road. It's a huge SUV (High Mass).</p>
                    <p class="mb-4">You try to push it alone. You are applying <strong>Force</strong>, but because the <strong>Mass</strong> is huge, the <strong>Acceleration</strong> is almost zero. The car barely moves.</p>
                    <p class="mb-4">Now, imagine 5 rugby players come to help. The total <strong>Force</strong> increases massively. Suddenly, the car starts moving faster (High Acceleration).</p>
                    <p class="italic text-slate-400">"The heavier the object, the harder you have to kick it to make it move." - That is Newton's Second Law.</p>
                `,
                exam: {
                    cbse: `
                        <div class="space-y-6">
                            <div class="p-4 bg-slate-800 rounded-lg border border-slate-700">
                                <span class="text-xs font-mono text-green-400">2 MARKS ‚Ä¢ NUMERICAL</span>
                                <p class="font-bold mt-1">Q: A force of 10N acts on a body of mass 2kg. Calculate the acceleration.</p>
                                <div class="mt-3 text-slate-300 text-sm hidden" id="ans1">
                                    <span class="text-blue-400 font-bold">Solution:</span><br>
                                    Given: F = 10N, m = 2kg<br>
                                    Formula: F = ma ‚Üí a = F/m<br>
                                    Calculation: a = 10/2 = <strong>5 m/s¬≤</strong>
                                </div>
                                <button onclick="toggleAns('ans1')" class="mt-3 text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded">Show Answer</button>
                            </div>
                             <div class="p-4 bg-slate-800 rounded-lg border border-slate-700">
                                <span class="text-xs font-mono text-green-400">3 MARKS ‚Ä¢ REASONING</span>
                                <p class="font-bold mt-1">Q: Why does a cricketer pull his hands back while catching a fast ball?</p>
                                <div class="mt-3 text-slate-300 text-sm hidden" id="ans2">
                                    <span class="text-blue-400 font-bold">Solution:</span><br>
                                    To increase the time (t) of impact. <br>
                                    Since Force is proportional to change in momentum / time (F ‚àù Œîp/t), increasing time <strong>reduces the force</strong> exerted on the hands, preventing injury.
                                </div>
                                <button onclick="toggleAns('ans2')" class="mt-3 text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded">Show Answer</button>
                            </div>
                        </div>
                    `
                },
                quiz: [
                    { q: "What is the formula for Newton's Second Law?", options: ["F = m/a", "F = ma", "F = m + a", "F = a/m"], correct: 1 },
                    { q: "If Mass increases and Force stays the same, Acceleration...", options: ["Increases", "Decreases", "Stays same", "Becomes zero"], correct: 1 },
                    { q: "SI Unit of Force is:", options: ["Joule", "Watt", "Newton", "Pascal"], correct: 2 }
                ]
            },
            "photosynthesis": {
                title: "Photosynthesis",
                tags: ["Biology", "Plants", "Energy"],
                simple: `
                    <h3 class="text-2xl font-bold mb-4 text-green-400">Plant Cooking 101</h3>
                    <p class="mb-4 text-lg">Photosynthesis is just how plants cook their own food using sunlight.</p>
                    <ul class="list-disc pl-6 space-y-2 mb-6 text-slate-300">
                        <li><strong>Ingredients:</strong> Water (from roots) + CO2 (from air).</li>
                        <li><strong>Fuel:</strong> Sunlight.</li>
                        <li><strong>Kitchen:</strong> Chloroplasts (green stuff in leaves).</li>
                        <li><strong>Result:</strong> Glucose (Sugar/Food) + Oxygen (fresh air).</li>
                    </ul>
                `,
                visual: `
                    graph LR
                    Sun((Sunlight)) -->|Energy| Leaf[Green Leaf]
                    Air(CO2) -->|Enters Stomata| Leaf
                    Water(H2O) -->|Roots to Xylem| Leaf
                    Leaf -->|Produces| Sugar[Glucose/Food]
                    Leaf -->|Releases| Oxygen(O2)
                    
                    style Sun fill:#facc15,stroke:#fff,stroke-width:2px,color:#000
                    style Leaf fill:#166534,stroke:#4ade80,stroke-width:2px
                    style Oxygen fill:#3b82f6,stroke:#fff
                `,
                story: `
                    <h3 class="text-xl font-bold mb-3 text-yellow-400">The Solar Panel Factory</h3>
                    <p class="mb-4">Think of a leaf as a factory covered in solar panels (Chlorophyll). The factory needs raw materials: Water (delivered by pipes/roots) and Carbon Dioxide (delivered by air).</p>
                    <p class="mb-4">When the sun hits the panels, the machines turn on. They smash the water and air together to create boxes of Sugar (Energy) to ship to the rest of the plant.</p>
                    <p class="italic text-slate-400">The 'exhaust' smoke from this factory isn't pollution‚Äîit's pure Oxygen, which we breathe!</p>
                `,
                exam: {
                    cbse: `
                         <div class="space-y-6">
                            <div class="p-4 bg-slate-800 rounded-lg border border-slate-700">
                                <span class="text-xs font-mono text-green-400">1 MARK ‚Ä¢ DEFINITION</span>
                                <p class="font-bold mt-1">Q: Write the chemical equation for photosynthesis.</p>
                                <div class="mt-3 text-slate-300 text-sm hidden" id="ans3">
                                    <span class="text-blue-400 font-bold">Solution:</span><br>
                                    6CO‚ÇÇ + 6H‚ÇÇO ‚Äî(Sunlight/Chlorophyll)‚Üí C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ + 6O‚ÇÇ
                                </div>
                                <button onclick="toggleAns('ans3')" class="mt-3 text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded">Show Answer</button>
                            </div>
                        </div>
                    `
                },
                quiz: [
                    { q: "Which gas is used BY the plant during photosynthesis?", options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"], correct: 2 },
                    { q: "Where does photosynthesis mainly occur?", options: ["Roots", "Stem", "Chloroplasts", "Flowers"], correct: 2 },
                    { q: "What is the primary product created?", options: ["Glucose", "Starch", "Protein", "Fat"], correct: 0 }
                ]
            }
        };

        // --- STATE ---
        let state = {
            step: 'onboarding', 
            class: null,
            board: null,
            currentTopicKey: null,
            quizScore: 0,
            quizIndex: 0
        };

        // --- NAVIGATION & RENDERERS ---

        function init() {
            renderOnboarding();
        }

        function resetApp() {
            state.step = 'onboarding';
            state.class = null;
            state.board = null;
            state.currentTopicKey = null;
            document.getElementById('user-badge').classList.add('hidden');
            renderOnboarding();
        }

        // 1. ONBOARDING VIEW
        function renderOnboarding() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="fade-in max-w-2xl w-full text-center mt-10">
                    <h1 class="text-5xl md:text-6xl font-extrabold mb-6 tracking-tight">Learn <span class="gradient-text">Your</span> Way.</h1>
                    <p class="text-slate-400 mb-10 text-xl">EduMorph adapts explanations, visuals, and quizzes to your syllabus.</p>
                    
                    <div class="glass p-8 rounded-3xl text-left border-t border-slate-600 shadow-2xl">
                        <div class="mb-6">
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Select Class</label>
                            <div class="flex gap-4">
                                <button onclick="selectClass(9)" id="btn-c9" class="flex-1 py-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 font-bold transition text-lg">Class 9</button>
                                <button onclick="selectClass(10)" id="btn-c10" class="flex-1 py-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 font-bold transition text-lg">Class 10</button>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Select Board</label>
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="selectBoard('CBSE')" id="btn-cbse" class="py-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 font-bold transition">CBSE</button>
                                <button onclick="selectBoard('ICSE')" id="btn-icse" class="py-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 font-bold transition">ICSE</button>
                            </div>
                        </div>

                        <button onclick="goToSearch()" id="btn-start" class="w-full py-4 bg-gradient-to-r from-green-500 to-blue-600 hover:opacity-90 text-white font-extrabold rounded-xl text-lg transition opacity-50 cursor-not-allowed shadow-lg shadow-blue-500/20" disabled>
                            Start Learning &rarr;
                        </button>
                    </div>
                </div>
            `;
        }

        // Logic Helpers
        function selectClass(c) {
            state.class = c;
            updateSelectionUI('btn-c', c, [9, 10]);
            checkReady();
        }
        function selectBoard(b) {
            state.board = b;
            updateSelectionUI('btn-', b.toLowerCase(), ['cbse', 'icse']);
            checkReady();
        }
        function updateSelectionUI(prefix, selected, options) {
            options.forEach(opt => {
                const el = document.getElementById(prefix + opt);
                if (el) {
                    el.classList.remove('bg-blue-600', 'text-white', 'border-blue-400');
                    el.classList.add('bg-slate-800', 'border-slate-600');
                }
            });
            const active = document.getElementById(prefix + selected);
            active.classList.remove('bg-slate-800', 'border-slate-600');
            active.classList.add('bg-blue-600', 'text-white', 'border-blue-400');
        }
        function checkReady() {
            if(state.class && state.board) {
                const btn = document.getElementById('btn-start');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // 2. SEARCH VIEW
        function goToSearch() {
            // Update Badge
            const badge = document.getElementById('user-badge');
            badge.innerText = `${state.board} ‚Ä¢ Class ${state.class}`;
            badge.classList.remove('hidden');

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="fade-in max-w-3xl w-full text-center mt-12">
                    <h2 class="text-3xl font-bold mb-8">What are you stuck on today?</h2>
                    
                    <div class="relative w-full group">
                        <div class="absolute inset-0 bg-gradient-to-r from-green-400 to-blue-600 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
                        <div class="relative bg-slate-900 rounded-2xl p-2 flex items-center border border-slate-700">
                            <input type="text" id="searchInput" placeholder="Try 'Newton's Laws' or 'Photosynthesis'..." 
                                class="w-full bg-transparent p-4 text-xl focus:outline-none text-white placeholder-slate-500"
                                onkeypress="if(event.key === 'Enter') processSearch()">
                            <button onclick="processSearch()" class="bg-blue-600 hover:bg-blue-500 px-8 py-3 rounded-xl font-bold transition mr-1">
                                Morph
                            </button>
                        </div>
                    </div>

                    <div class="mt-12">
                        <p class="text-sm text-slate-500 mb-4 uppercase tracking-wider font-bold">Trending Topics</p>
                        <div class="flex flex-wrap justify-center gap-3">
                            <span onclick="autoSearch('newton')" class="cursor-pointer px-4 py-2 rounded-full bg-slate-800 border border-slate-700 hover:border-blue-500 hover:text-blue-400 transition">üçé Newton's Second Law</span>
                            <span onclick="autoSearch('photosynthesis')" class="cursor-pointer px-4 py-2 rounded-full bg-slate-800 border border-slate-700 hover:border-green-500 hover:text-green-400 transition">üåø Photosynthesis</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function autoSearch(term) {
            document.getElementById('searchInput').value = term;
            processSearch();
        }

        function processSearch() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const app = document.getElementById('app');

            // Loading State
            app.innerHTML = `
                <div class="flex flex-col items-center justify-center h-64 fade-in">
                    <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-slate-400 animate-pulse">Scanning ${state.board} Syllabus...</p>
                </div>
            `;

            setTimeout(() => {
                if(term.includes('newton')) state.currentTopicKey = "newton's second law";
                else if(term.includes('photo')) state.currentTopicKey = "photosynthesis";
                else state.currentTopicKey = "newton's second law"; // Fallback for demo
                
                renderTopicDashboard();
            }, 1500);
        }

        // 3. TOPIC DASHBOARD
        function renderTopicDashboard(activeTab = 'simple') {
            const data = knowledgeBase[state.currentTopicKey];
            const app = document.getElementById('app');

            app.innerHTML = `
                <div class="fade-in w-full">
                    <button onclick="goToSearch()" class="mb-4 text-slate-400 hover:text-white text-sm flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                        Back to Search
                    </button>
                    
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="w-full lg:w-1/4 space-y-4">
                            <div class="glass-solid p-6 rounded-2xl border-l-4 border-green-500">
                                <h1 class="text-2xl font-bold leading-tight">${data.title}</h1>
                                <div class="flex gap-2 mt-3 flex-wrap">
                                    ${data.tags.map(t => `<span class="px-2 py-1 bg-slate-700 rounded text-xs text-slate-300">${t}</span>`).join('')}
                                </div>
                            </div>
                            
                            <div class="glass-solid p-6 rounded-2xl">
                                <div class="text-xs font-bold text-slate-400 uppercase mb-4">Actions</div>
                                <button onclick="openWorksheetModal()" class="w-full py-3 mb-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-semibold flex items-center justify-center gap-2 transition">
                                    üìÑ Worksheet
                                </button>
                                <button onclick="startQuiz()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:opacity-90 rounded-xl font-semibold flex items-center justify-center gap-2 shadow-lg shadow-blue-900/50 transition">
                                    ‚ö° Take Quiz
                                </button>
                            </div>
                        </div>

                        <div class="w-full lg:w-3/4">
                            <div class="flex gap-2 overflow-x-auto pb-2 mb-4 scrollbar-hide">
                                <button onclick="switchTab('simple')" id="tab-simple" class="px-5 py-2 rounded-full text-sm font-bold border border-transparent transition">Simple</button>
                                <button onclick="switchTab('visual')" id="tab-visual" class="px-5 py-2 rounded-full text-sm font-bold border border-transparent transition">Visual</button>
                                <button onclick="switchTab('story')" id="tab-story" class="px-5 py-2 rounded-full text-sm font-bold border border-transparent transition">Story</button>
                                <button onclick="switchTab('exam')" id="tab-exam" class="px-5 py-2 rounded-full text-sm font-bold border border-transparent transition">Exam</button>
                            </div>

                            <div id="content-area" class="glass p-8 rounded-3xl min-h-[400px]">
                                </div>
                        </div>
                    </div>
                </div>
            `;
            
            switchTab(activeTab);
        }

        function switchTab(tabName) {
            // UI Updates
            ['simple', 'visual', 'story', 'exam'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if(t === tabName) {
                    btn.className = "px-5 py-2 rounded-full text-sm font-bold bg-blue-600 text-white shadow-lg shadow-blue-500/30 transform scale-105 transition";
                } else {
                    btn.className = "px-5 py-2 rounded-full text-sm font-bold bg-slate-800 text-slate-400 border border-slate-700 hover:bg-slate-700 transition";
                }
            });

            const contentDiv = document.getElementById('content-area');
            const data = knowledgeBase[state.currentTopicKey];

            // Render Content
            contentDiv.style.opacity = 0;
            setTimeout(() => {
                if(tabName === 'visual') {
                    contentDiv.innerHTML = `<div class="mermaid">${data.visual}</div>`;
                    mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                } else if (tabName === 'exam') {
                    contentDiv.innerHTML = data.exam.cbse; // simplified for demo
                } else {
                    contentDiv.innerHTML = data[tabName];
                }
                contentDiv.style.opacity = 1;
                contentDiv.className = "glass p-8 rounded-3xl min-h-[400px] fade-in";
            }, 150);
        }

        function toggleAns(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }

        // 4. QUIZ SYSTEM (Fully Functional)
        function startQuiz() {
            state.quizScore = 0;
            state.quizIndex = 0;
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const data = knowledgeBase[state.currentTopicKey];
            const qData = data.quiz[state.quizIndex];
            const app = document.getElementById('app');

            app.innerHTML = `
                <div class="fade-in max-w-2xl w-full mt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Quiz Time</h2>
                        <span class="text-slate-400 text-sm">Question ${state.quizIndex + 1} of ${data.quiz.length}</span>
                    </div>

                    <div class="glass p-8 rounded-2xl relative overflow-hidden">
                        <div class="h-1 bg-slate-700 absolute top-0 left-0 w-full">
                            <div class="h-full bg-blue-500 transition-all duration-300" style="width: ${((state.quizIndex + 1) / data.quiz.length) * 100}%"></div>
                        </div>

                        <h3 class="text-xl font-semibold mb-6 mt-2">${qData.q}</h3>
                        
                        <div class="space-y-3" id="options-container">
                            ${qData.options.map((opt, idx) => `
                                <button onclick="checkAnswer(${idx})" class="option-btn w-full text-left p-4 rounded-xl bg-slate-800 border border-slate-700 hover:border-blue-500 transition flex justify-between items-center group">
                                    <span>${opt}</span>
                                    <span class="w-4 h-4 rounded-full border border-slate-500 group-hover:border-blue-500"></span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                     <button onclick="renderTopicDashboard()" class="mt-6 text-slate-500 hover:text-white underline text-sm">Cancel Quiz</button>
                </div>
            `;
        }

        function checkAnswer(selectedIndex) {
            const data = knowledgeBase[state.currentTopicKey];
            const qData = data.quiz[state.quizIndex];
            const correctIndex = qData.correct;
            const buttons = document.querySelectorAll('.option-btn');

            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);

            // Logic styling
            if(selectedIndex === correctIndex) {
                state.quizScore++;
                buttons[selectedIndex].classList.remove('bg-slate-800', 'border-slate-700');
                buttons[selectedIndex].classList.add('bg-green-900', 'border-green-500', 'text-green-100');
                buttons[selectedIndex].innerHTML += ` ‚úÖ`;
            } else {
                buttons[selectedIndex].classList.remove('bg-slate-800', 'border-slate-700');
                buttons[selectedIndex].classList.add('bg-red-900', 'border-red-500', 'text-red-100');
                buttons[correctIndex].classList.remove('bg-slate-800', 'border-slate-700');
                buttons[correctIndex].classList.add('bg-green-900', 'border-green-500'); // Show correct one
            }

            // Next Question Delay
            setTimeout(() => {
                state.quizIndex++;
                if(state.quizIndex < data.quiz.length) {
                    renderQuizQuestion();
                } else {
                    renderQuizResult(data.quiz.length);
                }
            }, 1500);
        }

        function renderQuizResult(total) {
            const percentage = (state.quizScore / total) * 100;
            let message = "";
            let action = "";
            
            if(percentage === 100) { message = "Perfect Score! üåü"; action = "You are exam ready."; }
            else if(percentage > 50) { message = "Good Job! üëç"; action = "Review the weak spots."; }
            else { message = "Needs Revision üìö"; action = "Go back to the 'Simple' tab."; }

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="fade-in max-w-lg w-full text-center mt-12">
                    <div class="glass p-10 rounded-3xl border-t border-blue-500 shadow-2xl">
                        <div class="text-6xl mb-4">${percentage === 100 ? 'üèÜ' : 'üìä'}</div>
                        <h2 class="text-3xl font-bold mb-2">Quiz Complete</h2>
                        <p class="text-slate-400 mb-6">${action}</p>
                        
                        <div class="text-5xl font-black gradient-text mb-8">${state.quizScore} / ${total}</div>
                        
                        <button onclick="renderTopicDashboard()" class="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-white transition">
                            Back to Topic
                        </button>
                    </div>
                </div>
            `;
        }

        // 5. WORKSHEET MODAL
        function openWorksheetModal() {
            const data = knowledgeBase[state.currentTopicKey];
            const modal = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');

            content.innerHTML = `
                <div class="text-center border-b pb-4 mb-4 border-slate-200">
                    <h2 class="text-2xl font-bold text-slate-900">EduMorph Worksheet</h2>
                    <p class="text-sm text-slate-500 uppercase">Class ${state.class} ‚Ä¢ ${state.board} ‚Ä¢ ${data.title}</p>
                </div>
                <div class="space-y-6 text-slate-800">
                    <div>
                        <h3 class="font-bold border-b border-slate-300 mb-2">Part A: Define</h3>
                        <p class="h-20 border border-dashed border-slate-300 rounded bg-slate-50 p-2 text-sm text-slate-400">Student writes here...</p>
                    </div>
                    <div>
                        <h3 class="font-bold border-b border-slate-300 mb-2">Part B: Draw Diagram</h3>
                        <div class="h-32 border border-slate-300 rounded flex items-center justify-center bg-slate-50">
                            <span class="text-slate-400 text-sm italic">Draw the ${data.title} diagram here</span>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold border-b border-slate-300 mb-2">Part C: Solve</h3>
                        <p class="text-sm mb-2">1. ${data.quiz[1].q}</p>
                        <p class="h-16 border border-dashed border-slate-300 rounded bg-slate-50"></p>
                    </div>
                </div>
                <div class="mt-6 flex gap-3">
                    <button onclick="window.print()" class="flex-1 bg-slate-900 text-white py-2 rounded-lg hover:bg-slate-800 transition">Print PDF</button>
                    <button onclick="closeModal()" class="flex-1 border border-slate-300 py-2 rounded-lg hover:bg-slate-100 transition">Close</button>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        // Init
        init();

    </script>
</body>
</html>
